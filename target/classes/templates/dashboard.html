<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis Match Prediction Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        :root {
            --tennis-green: #2e7d32;
            --tennis-yellow: #ffd700;
            --tennis-blue: #1976d2;
            --tennis-red: #d32f2f;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--tennis-green) !important;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--tennis-green), #4caf50);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: bold;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .live-match {
            border-left: 4px solid var(--tennis-red);
            background-color: #fff3cd;
        }
        
        .prediction-card {
            border-left: 4px solid var(--tennis-blue);
        }
        
        .player-card {
            border-left: 4px solid var(--tennis-green);
        }
        
        .score-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--tennis-green);
        }
        
        .confidence-badge {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }
        
        .btn-tennis {
            background: linear-gradient(135deg, var(--tennis-green), #4caf50);
            border: none;
            color: white;
            border-radius: 25px;
            padding: 0.5rem 1.5rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-tennis:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        .prediction-accuracy {
            font-size: 2rem;
            font-weight: bold;
            color: var(--tennis-green);
        }
        
        .match-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-live {
            background-color: var(--tennis-red);
            color: white;
        }
        
        .status-completed {
            background-color: var(--tennis-green);
            color: white;
        }
        
        .status-scheduled {
            background-color: var(--tennis-blue);
            color: white;
        }
        
        .player-rank {
            background-color: var(--tennis-yellow);
            color: #333;
            padding: 0.25rem 0.5rem;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .surface-badge {
            background-color: #e3f2fd;
            color: var(--tennis-blue);
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .loading-spinner {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-table-tennis me-2"></i>
                Tennis Prediction AI
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-chart-line me-1"></i>
                    Accuracy: <span class="prediction-accuracy" th:text="${#numbers.formatDecimal(predictionAccuracy, 1, 1)} + '%'">0.0%</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center mb-3">
                    <i class="fas fa-trophy text-warning me-2"></i>
                    Tennis Match Prediction Dashboard
                </h1>
                <p class="text-center text-muted">
                    Real-time predictions powered by AI algorithms analyzing player statistics, head-to-head records, and live match data
                </p>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-users fa-2x mb-2"></i>
                        <h4 class="card-title">Players</h4>
                        <p class="card-text display-6">10</p>
                        <small>Top ranked players</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-table-tennis fa-2x mb-2"></i>
                        <h4 class="card-title">Live Matches</h4>
                        <p class="card-text display-6" th:text="${liveMatches.size()}">0</p>
                        <small>Currently playing</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-brain fa-2x mb-2"></i>
                        <h4 class="card-title">Predictions</h4>
                        <p class="card-text display-6" th:text="${recentPredictions.size()}">0</p>
                        <small>Last 24 hours</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card stats-card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-chart-line fa-2x mb-2"></i>
                        <h4 class="card-title">Accuracy</h4>
                        <p class="card-text display-6" th:text="${#numbers.formatDecimal(predictionAccuracy, 1, 1)} + '%'">0.0%</p>
                        <small>Prediction success rate</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Live Matches -->
            <div class="col-lg-8 mb-4">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-broadcast-tower me-2"></i>
                        Live Matches
                    </div>
                    <div class="card-body">
                        <div th:if="${liveMatches.empty}" class="text-center text-muted py-4">
                            <i class="fas fa-info-circle fa-3x mb-3"></i>
                            <p>No live matches at the moment</p>
                        </div>
                        
                        <div th:each="match : ${liveMatches}" class="live-match p-3 mb-3 rounded">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0" th:text="${match.player1.name + ' vs ' + match.player2.name}">Player 1 vs Player 2</h6>
                                        <span class="match-status status-live">LIVE</span>
                                    </div>
                                    <div class="score-display mb-2" th:text="${match.currentScore}">1-0 (4-3)</div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted" th:text="${match.tournamentName + ' - ' + match.surface}">Tournament - Surface</small>
                                        <small class="text-muted" th:text="${'Set ' + match.currentSet}">Set 1</small>
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <button class="btn btn-tennis btn-sm me-2" 
                                            th:onclick="'predictMatchWinner(' + ${match.id} + ')'">
                                        <i class="fas fa-crystal-ball me-1"></i>
                                        Predict Winner
                                    </button>
                                    <button class="btn btn-outline-primary btn-sm" 
                                            th:onclick="'predictGameWinner(' + ${match.id} + ')'">
                                        <i class="fas fa-gamepad me-1"></i>
                                        Predict Game
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Players -->
            <div class="col-lg-4 mb-4">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-crown me-2"></i>
                        Top Players
                    </div>
                    <div class="card-body">
                        <div th:each="player, iterStat : ${topPlayers}" class="player-card p-3 mb-2 rounded">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="player-rank me-2" th:text="${player.currentRanking}">1</span>
                                    <strong th:text="${player.name}">Player Name</strong>
                                </div>
                                <div class="text-end">
                                    <div class="surface-badge mb-1" th:text="${player.bestSurface}">Hard Court</div>
                                    <small class="text-muted" th:text="${player.country}">Country</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Predictions -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-brain me-2"></i>
                        Recent Predictions
                    </div>
                    <div class="card-body">
                        <div th:if="${recentPredictions.empty}" class="text-center text-muted py-4">
                            <i class="fas fa-chart-bar fa-3x mb-3"></i>
                            <p>No recent predictions</p>
                        </div>
                        
                        <div th:each="prediction : ${recentPredictions}" class="prediction-card p-3 mb-3 rounded">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h6 class="mb-1" th:text="${prediction.predictedWinnerName}">Predicted Winner</h6>
                                    <small class="text-muted" th:text="${prediction.predictionType.replace('_', ' ')}">Prediction Type</small>
                                </div>
                                <div class="col-md-3 text-center">
                                    <span class="badge bg-success confidence-badge" 
                                          th:text="${prediction.confidenceLevel}">High</span>
                                    <br>
                                    <small class="text-muted" th:text="${#numbers.formatDecimal(prediction.confidenceScore * 100, 1, 1)} + '%'">85.5%</small>
                                </div>
                                <div class="col-md-3 text-end">
                                    <small class="text-muted" th:text="${#temporals.format(prediction.predictionTimestamp, 'HH:mm')}">14:30</small>
                                    <br>
                                    <small class="text-muted" th:text="${prediction.mostInfluentialFactor}">Ranking</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <button class="btn btn-tennis refresh-btn" onclick="location.reload()">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Loading Spinner -->
    <div class="loading-spinner position-fixed top-50 start-50 translate-middle" style="z-index: 9999;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Auto-refresh every 30 seconds
        setInterval(function() {
            location.reload();
        }, 30000);
        
        // Show loading spinner
        function showLoading() {
            document.querySelector('.loading-spinner').style.display = 'block';
        }
        
        // Hide loading spinner
        function hideLoading() {
            document.querySelector('.loading-spinner').style.display = 'none';
        }
        
        // Predict match winner
        function predictMatchWinner(matchId) {
            showLoading();
            fetch(`/tennis-prediction/api/predictions/match-winner/${matchId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                alert(`Prediction: ${data.predictedWinnerName}\nConfidence: ${(data.confidenceScore * 100).toFixed(1)}%\nReasoning: ${data.predictionReasoning}`);
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                alert('Error making prediction');
            });
        }
        
        // Predict game winner
        function predictGameWinner(matchId) {
            showLoading();
            fetch(`/tennis-prediction/api/predictions/game-winner/${matchId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                alert(`Game Prediction: ${data.predictedWinnerName}\nConfidence: ${(data.confidenceScore * 100).toFixed(1)}%\nReasoning: ${data.predictionReasoning}`);
            })
            .catch(error => {
                hideLoading();
                console.error('Error:', error);
                alert('Error making prediction');
            });
        }
        
        // Add fade-in animation to cards
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('fade-in');
                }, index * 100);
            });
        });
    </script>
</body>
</html>